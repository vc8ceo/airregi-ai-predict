# Airレジ 来店数・売上予測システム - プロジェクトサマリー

## プロジェクト概要

### 目的
Airレジ（POSシステム）のジャーナル履歴データと天気予報情報を活用し、機械学習により店舗の営業日ごとの**来店数**と**売上**を高精度で予測することで、店舗の在庫管理・人員配置の最適化を支援します。

### 背景
- **課題**: 日々の来店数と売上が予測できないため、過剰在庫や人員不足が発生
- **解決策**: 機械学習による高精度な予測により、適切な準備が可能に
- **期待効果**: 在庫ロス削減、人件費最適化、顧客満足度向上

---

## システム設計の要点

### データソース
1. **Airレジ ジャーナル履歴CSV**
   - 期間: 直近3ヶ月分（定期取得により蓄積）
   - 粒度: 商品明細レベル
   - 主要データ: 伝票No、売上日時、商品名、金額、支払方法

2. **天気予報API（WeatherAPI）**
   - 過去データ: 実績分析用
   - 予報データ: 予測用（翌日の天気）
   - 取得項目: 天候、気温、降水確率、湿度、風速

### アーキテクチャ
```
[データ収集] → [前処理] → [特徴量生成] → [機械学習] → [予測API] → [利用者]
     ↑                                          ↓
[天気API] ←─────────────────────────── [日次バッチ処理]
```

### 主要コンポーネント
1. **データ前処理パイプライン**: CSV読み込み、日次集計、データ検証
2. **特徴量エンジニアリング**: 時系列・ラグ・ローリング統計特徴量の生成
3. **機械学習モデル**: LightGBM、Prophet、LSTM、アンサンブル
4. **予測API**: FastAPIによるREST APIサーバー
5. **バッチ処理**: 日次自動予測・再学習

---

## 予測精度目標

| 項目 | 来店数 | 売上 |
|-----|-------|------|
| **目標MAPE** | < 15% | < 20% |
| **目標MAE** | < 8人 | < 500円 |

---

## データ統計（サンプルデータ: 2025/08/02 - 2025/10/13）

| 指標 | 値 |
|-----|-----|
| 営業日数 | 20日 |
| 総取引数 | 1,121件 |
| 総売上 | 52,229円 |
| 平均客単価 | 約47円 |
| 1日平均来店数 | 56組 |
| 1日平均売上 | 2,611円 |

---

## 技術スタック

### プログラミング言語
- Python 3.10+

### データ処理・機械学習
- pandas, numpy: データ操作
- scikit-learn: 前処理・評価
- LightGBM: 勾配ブースティング
- Prophet: 時系列予測
- TensorFlow/PyTorch: ディープラーニング（LSTM）
- Optuna: ハイパーパラメータチューニング

### API・Web
- FastAPI: REST APIフレームワーク
- uvicorn: ASGIサーバー
- Pydantic: データバリデーション

### 外部サービス
- WeatherAPI: 天気情報取得（無料枠: 1,000,000リクエスト/月）

---

## ドキュメント構成

| No | ドキュメント名 | 内容 |
|----|--------------|------|
| 01 | [データディクショナリ](01_data_dictionary.md) | CSVデータの構造・カラム定義 |
| 02 | [システムアーキテクチャ](02_system_architecture.md) | 全体構成・技術スタック・モジュール設計 |
| 03 | [データ前処理パイプライン](03_data_pipeline.md) | データ読み込み・集計・特徴量生成 |
| 04 | [機械学習モデル](04_ml_models.md) | モデル選定・訓練・評価・チューニング |
| 05 | [天気API統合](05_weather_api_integration.md) | WeatherAPI連携・キャッシング |
| 06 | [予測API仕様](06_prediction_api.md) | エンドポイント定義・レスポンス形式 |
| 07 | [実装計画](07_implementation_plan.md) | 開発フェーズ・タスク・タイムライン |

---

## 実装フェーズ（8-9週間）

### Phase 1: 基盤構築（Week 1-2）
- 開発環境セットアップ
- CSVデータ読み込み・検証
- 天気APIクライアント実装
- EDA（探索的データ分析）

### Phase 2: 特徴量エンジニアリング（Week 2-3）
- 日次集計処理
- 時系列・ラグ・ローリング特徴量生成
- 天気データとの統合

### Phase 3: モデル開発（Week 3-5）
- ベースラインモデル
- LightGBM、Prophet、LSTMモデル実装
- ハイパーパラメータチューニング
- アンサンブルモデル

### Phase 4: API開発（Week 5-6）
- FastAPI実装
- エンドポイント開発
- 認証・セキュリティ

### Phase 5: バッチ処理・自動化（Week 6-7）
- 日次予測スクリプト
- 再学習スクリプト
- スケジューラー設定

### Phase 6: テスト・検証（Week 7-8）
- ユニットテスト
- 統合テスト
- 本番データ検証

### Phase 7: ドキュメント・デプロイ（Week 8-9）
- ドキュメント整備
- Dockerコンテナ化
- 本番環境デプロイ

---

## 主要な特徴量

### 時系列特徴量
- 曜日、月、季節、祝日フラグ、週末フラグ
- 周期性エンコーディング（sin/cos変換）

### ラグ特徴量
- 1日前、7日前、14日前、30日前の来店数・売上

### ローリング統計
- 7日間・30日間の移動平均・標準偏差・最大値・最小値

### 天気特徴量
- 天候カテゴリ、最高/最低/平均気温、湿度、降水量、風速

---

## 運用フロー

### 日次運用（毎日AM 6:00実行）
1. 前日の実績データをインポート
2. 実績データをデータベースに追加
3. 直近データで再学習（週1回）
4. 翌営業日の天気予報を取得
5. 翌営業日の来店数・売上を予測
6. 予測結果をAPI経由で提供
7. ダッシュボード更新

### モデル再学習戦略
- **週次**: 増分学習（新しいデータを追加）
- **月次**: 全データで再学習
- **年次**: モデルアーキテクチャの見直し

---

## セキュリティ

### データ保護
- APIキーは環境変数で管理（`.env`ファイル）
- 個人情報の匿名化を検討
- 定期的なデータバックアップ

### API認証
- 管理者用エンドポイントにAPI Key認証
- レート制限による過剰アクセス防止

---

## 期待される成果

### ビジネス価値
1. **在庫最適化**: 予測に基づく適切な仕入れで在庫ロス削減（目標: 20%削減）
2. **人員配置最適化**: 来店数予測によるスタッフシフト最適化
3. **売上向上**: 品切れ防止による機会損失の削減
4. **経営判断支援**: データドリブンな意思決定

### 技術的成果
1. 高精度な時系列予測モデルの構築
2. スケーラブルなシステムアーキテクチャ
3. 複数店舗への展開が可能な設計
4. 継続的な改善が可能な仕組み

---

## 今後の拡張性

### 短期（3-6ヶ月）
- 商品カテゴリ別売上予測
- 時間帯別来店数予測
- 予測精度のダッシュボード化

### 中期（6-12ヶ月）
- 複数店舗対応（マルチテナント化）
- リアルタイム予測機能
- 在庫最適化機能の追加

### 長期（1年以上）
- 需要予測に基づく自動発注システム
- SNSトレンドデータの統合
- 競合店舗分析機能

---

## リスクと対策

| リスク | 影響度 | 対策 |
|-------|--------|------|
| データ品質問題 | 高 | データバリデーションの厳格化 |
| 天気API利用制限 | 中 | キャッシング機能の実装 |
| モデル精度不足 | 高 | 複数モデルの試行・アンサンブル |
| モデルドリフト | 中 | 定期的な再学習とモニタリング |

---

## プロジェクト成功の鍵

1. **データの継続的な蓄積**: 過去データが増えるほど予測精度が向上
2. **定期的なモデル更新**: モデルドリフトを防ぐための継続的改善
3. **ビジネスとの連携**: 予測結果を実際の業務に活用するフィードバックループ
4. **システムの保守性**: 可読性が高く、拡張しやすいコード設計

---

## 次のステップ

1. **即座に開始可能**: [実装計画](07_implementation_plan.md)に従い、Phase 1から着手
2. **環境構築**: Python環境、必要なライブラリのインストール
3. **データ準備**: ジャーナル履歴CSVと天気APIキーの取得
4. **EDA実施**: データの特性を理解し、予測戦略を洗練

---

## まとめ

本システムは、POSデータと天気情報を組み合わせた機械学習により、店舗の来店数と売上を高精度で予測します。実装は8-9週間で完了し、以下の価値を提供します：

✅ **予測精度**: MAPE 15-20%以下の高精度予測
✅ **自動化**: 日次バッチによる完全自動予測
✅ **拡張性**: 複数店舗・複数機能への展開が可能
✅ **運用性**: REST APIによる柔軟な利用方法

---

## 作成日

2025年10月13日

## 作成者

Claude (Anthropic AI Assistant)

## バージョン

1.0.0
